distributable:
  url: git+https://github.com/hashicorp/vault
  ref: ${{version.tag}}

versions:
  github: hashicorp/vault

build:
  dependencies:
    go.dev: =1.25.5 # as of 1.21.2
    nodejs.org: ^20 # as of 1.20.0
    # python 3.11 removes 'rU' mode which breaks node-gyp
    python.org: ~3.10
    npmjs.com: "*"
    classic.yarnpkg.com: "*"
    git-scm.org: "*"
    # TODO: gox
    pkgx.sh: "*" # to use pkgx go= in script
  script:
    - go mod tidy
    # required tooling; no releases to package
    - run:
        # enumer doesn't build on newer go versions, but we need a newer go for vault itself
        - command -v enumer || pkgx go=1.22 install github.com/loggerhead/enumer@latest
        - export PATH=$HOME/go/bin:$PATH
      if: ">=1.16.2"
    - make bootstrap static-dist dev-ui
    - install -D bin/vault {{prefix}}/bin/vault

provides:
  - bin/vault

test: vault --version
