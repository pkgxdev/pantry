distributable:
  url: https://github.com/fluentci-io/fluentci/archive/refs/tags/v{{ version }}.tar.gz
  strip-components: 1

display-name: fluentci

versions:
  github: fluentci-io/fluentci

dependencies:
  dagger.io: ^0.8.8
  deno.land: ^1.36
  charm.sh/glow: ^1.5.1

build:
  dependencies:
    deno.land: ~1.37
  script: |
    deno compile -A --unstable --import-map="$SRCROOT"/import_map.json --output fluentci ./main.ts
    mkdir -p "{{ prefix }}"/bin
    cp fluentci "{{ prefix }}"/bin
  skip: fix-patchelf

provides:
  - bin/fluentci

test:
  - fluentci --version
  # contains shell escapes; can't use test
  - fluentci --version | grep {{ version }}
