distributable:
  url: https://mirror.openshift.com/pub/openshift-v{{version.major}}/clients/ocp/{{version}}/openshift-client-src.tar.gz
  strip-components: 1

versions:
  url: https://mirror.openshift.com/pub/openshift-v4/clients/ocp/
  match: /\d+\.\d+\.\d+/

dependencies:
  kerberos.org: ^1.21

build:
  dependencies:
    go.dev: ~1.16
  script:
    - make cross-build-{{hw.platform}}-${ARCH} OS_GIT_VERSION={{version}}
    - install -D _output/bin/{{hw.platform}}_${ARCH}/oc {{prefix}}/bin/oc
  env:
    x86-64:
      ARCH: amd64
    aarch64:
      ARCH: arm64

provides:
  - bin/oc

test:
  script:
    - touch ./kubeconfig
    - oc version --client --output=json | grep {{version}}
    - oc config set-context foo 2>&1 | grep 'created'
    - oc config get-contexts -o name | grep 'foo'
    - cat kubeconfig | grep 'foo'
  env:
    KUBECONFIG: $PWD/kubeconfig
