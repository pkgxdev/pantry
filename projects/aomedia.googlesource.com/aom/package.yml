distributable:
  url: https://aomedia.googlesource.com/aom/+archive/v{{version}}.tar.gz

versions:
  url: https://aomedia.googlesource.com/aom/+refs
  match: /refs\/tags\/v\d+\.\d+\.\d+"/
  strip:
    - /refs\/tags\/v/
    - /"/

build:
  dependencies:
    x86-64:
      nasm.us: 2
    cmake.org: ^3
  working-directory:
    out
  script: |
    cmake .. $ARGS
    make
    make install
  env:
    ARGS:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_PREFIX="{{prefix}}"
    linux:
      CFLAGS: -fPIC
      CXXFLAGS: -fPIC
      LDFLAGS: -pie
test: |
  aomenc --help
  aomdec --help

provides:
  - bin/aomenc
  - bin/aomdec
