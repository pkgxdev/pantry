distributable:
  url: https://github.com/stub42/pytz/archive/release_{{version.raw}}.tar.gz
  strip-components: 1

versions:
  github: stub42/pytz/tags
  strip: /^release_/

dependencies:
  python.org: '>=3.11'

runtime:
  env:
    PYTHONPATH: ${{prefix}}/lib/python{{deps.python.org.version.major}}/site-packages:$PYTHONPATH

build:
  dependencies:
    linux:
      gnu.org/gcc: '*'
      gnu.org/gawk: '*' # awk has a malloc/free issue with the build script
      rsync.samba.org: '*'
  script:
    - make dist
    - run: python -m pip install --prefix={{prefix}} .
      working-directory: src
    - run: ln -s python{{deps.python.org.version.marketing}} python{{deps.python.org.version.major}}
      working-directory: ${{prefix}}/lib
  env:
    linux:
      CC: gcc

test:
  - python -c 'import pytz; print(pytz.__version__)' | grep {{version.raw}}
  - python -c 'import pytz; print(pytz.timezone("UTC"))' | grep UTC
