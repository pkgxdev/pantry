distributable:
  url: https://github.com/alexellis/k3sup/archive/{{version}}.tar.gz
  strip-components: 1

versions:
  github: alexellis/k3sup

build:
  dependencies:
    go.dev: ^1.20
  env:
    CGO_ENABLED: 0
    LDFLAGS:
    - -s
    - -w
    - -X github.com/alexellis/k3sup/cmd.Version={{ version }}
    - -X github.com/alexellis/k3sup/cmd.GitCommit=$( git rev-parse HEAD )
    linux:
      LDFLAGS:
      - -buildmode=pie
  script: 
    - go build -v -ldflags="${LDFLAGS}"
    - mkdir -p "{{ prefix }}"/bin
    - mv k3sup "{{ prefix }}"/bin

provides:
- bin/k3sup

test:
  dependencies:
    k3sup: '*'  # asterisk means “any version, usually the latest”
  script:
    test "$(k3sup --version)" = {{version}}
