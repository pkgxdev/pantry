distributable:
  url: https://github.com/psf/black/archive/refs/tags/{{ version }}.tar.gz
  strip-components: 1

versions:
  github: psf/black/releases/tags
  strip: /^v/

dependencies:
  pkgx.sh: '>=1'

build:
  dependencies:
    python.org: '>=3.7<3.12'
  script:
    - bkpyvenv stage {{prefix}} {{version}}
    - ${{prefix}}/venv/bin/pip install '.[d]'
    - bkpyvenv seal {{prefix}} black
    - run: cp black blackd
      working-directory: ${{prefix}}/bin

provides:
  - bin/black
  - bin/blackd

test:
  - test "$(black --version | grep black | sed 's/.*, \([^ ]*\) .*/\1/')" = "{{ version }}"
  - test "$(blackd --version | sed 's/.* //')" = "{{ version }}"
