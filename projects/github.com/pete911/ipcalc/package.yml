distributable:
  url: https://github.com/pete911/ipcalc/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1

display-name: ipcalc

versions:
  github: pete911/ipcalc

build:
  dependencies:
    go.dev: ^1.20
  env:
    CGO_ENABLED: 0
    GO_ARGS:
      - -o "{{prefix}}/bin/"
    GO_LDFLAGS:
      - -s
      - -w
      - -X main.Version={{version}}
    linux:
      GO_LDFLAGS:
        - -buildmode=pie
  script:
    - test -f go.mod || go mod init
    - go mod tidy
    - go mod vendor
    - go build ${GO_ARGS} -ldflags="${GO_LDFLAGS}" ./

provides:
  - bin/ipcalc

test: test "$(ipcalc|grep version|cut -d' ' -f 2)" = {{version}}
