distributable:
  url: https://github.com/kdave/btrfs-progs/archive/v{{version}}.tar.gz
  strip-components: 1

versions:
  github: kdave/btrfs-progs

platforms:
  - linux

dependencies:
  # e2fsprogs
  oberhumer.com/lzo: ^2.10
  systemd.io: ^255 # for libudev
  github.com/util-linux/util-linux: ^2.39
  zlib.net: ^1.3
  facebook.com/zstd: ^1.5

build:
  dependencies:
    python.org: ^3.11
    sphinx-doc.org: '*'
    gnu.org/autoconf: '*'
    gnu.org/automake: '*'
    gnu.org/libtool: '*'
  script:
    - patch -p1 < props/patch.diff # remove sphinx-rtd-theme extension for html docs
    - ./autogen.sh
    - ./configure $ARGS
    - make --jobs {{hw.concurrency}} install V=1 udevdir={{prefix}}/lib/udev
  env:
    ARGS:
      - --disable-debug
      - --disable-dependency-tracking
      - --prefix={{prefix}}
      - --libdir={{prefix}}/lib

provides:
  - bin/btrfs

test:
  - btrfs --version