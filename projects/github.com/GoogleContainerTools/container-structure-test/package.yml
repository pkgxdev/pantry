distributable:
  url: https://github.com/GoogleContainerTools/container-structure-test/archive/refs/tags/v{{ version }}.tar.gz
  strip-components: 1

provides:
  - bin/container-structure-test

versions:
  github: GoogleContainerTools/container-structure-test
  strip: /v/

build:
  dependencies:
    go.dev: ^1.19
    goreleaser.com: "*"
    git-scm.org: "*"
  script: |
    goreleaser build --clean --single-target --skip=validate
    mkdir -p "{{ prefix }}"/bin
    mv dist/container-structure-test_$PLATFORM/dive "{{ prefix }}"/bin
  env:
    CGO_ENABLED: 0
    darwin/aarch64: {PLATFORM: darwin_arm64}
    darwin/x86-64:  {PLATFORM: darwin_amd64_v1}
    linux/aarch64:  {PLATFORM: linux_arm64}
    linux/x86-64:   {PLATFORM: linux_amd64_v1}

test:
  script:
    - test "$(container-structure-test --version)" = "container-structure-test {{version}}"
