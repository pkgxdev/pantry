distributable:
  url: https://github.com/blynn/nex/archive/refs/heads/master.tar.gz
  strip-components: 1

display-name: nex

versions:
# no version published, use the last code available
- 0.0.0

build:
  dependencies:
    rsync.samba.org: '*'
    go.dev: ^1.20
  env:
    CGO_ENABLED: 0
    GO_LDFLAGS:
    - -s
    - -w
    linux:
      GO_LDFLAGS:
      - -buildmode=pie
  script:
  - go build -v -ldflags="${GO_LDFLAGS}" -o "{{prefix}}"/bin/nex ./main.go ./nex.go
  - rsync -avH ./test "{{prefix}}"

provides:
- bin/nex

test:
  dependencies:
    go.dev: '*'
  script: nex -r -s {{prefix}}/test/lc.nex < /etc/protocols
