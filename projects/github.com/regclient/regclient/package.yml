distributable:
  url: git+https://github.com/regclient/regclient
  ref: v{{ version }}

versions:
  github: regclient/regclient/releases/tags

provides:
  - bin/regctl
  - bin/regsync
  - bin/regbot

dependencies:
  curl.se/ca-certs: '*'

build:
  dependencies:
    go.dev: ^1.21
    git-scm.org: '*'
  script: |
    make binaries
    mkdir -p '{{ prefix }}/bin'
    mv -f ./bin/{regctl,regsync,regbot} '{{ prefix }}/bin'

test:
  script: |
    regctl version | tee /dev/stderr | grep -q -w "v{{ version }}"
    regsync version | tee /dev/stderr | grep -q -w "v{{ version }}"
    regbot version | tee /dev/stderr | grep -q -w "v{{ version }}"

    regctl image inspect hello-world --platform linux/amd64 | tee /dev/stderr | grep -q -w '"Image":'
