distributable:
  url: https://github.com/dundee/gdu/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1
display-name: gdu

versions:
  github: dundee/gdu

build:
  dependencies:
    go.dev: '*' 
  env:
    BUILD_VERSION: "{{ version }}"
    BUILD_HORODATE: "$(date +'%Y-%m-%d')"
    BUILD_USER: "$(id -u -n)"
    MAJOR_VER: "v{{version.major}}"
    CGO_ENABLED: 0
    GO_LDFLAGS:
    - -s
    - -w
    - -X github.com/dundee/gdu/${MAJOR_VER}/build.Version="${BUILD_VERSION}"
    - -X github.com/dundee/gdu/${MAJOR_VER}/build.Time="${BUILD_HORODATE}"
    - -X github.com/dundee/gdu/${MAJOR_VER}/build.User="${BUILD_USER}"
    linux:
      GO_LDFLAGS:
      - -buildmode=pie
  script: go build -v -ldflags="${GO_LDFLAGS}" -o "{{ prefix }}"/bin/gdu ./cmd/gdu

provides:
- bin/gdu

test: test "$(gdu --version|grep Version|cut -d' ' -f2)" = {{version}}
