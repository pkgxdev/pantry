distributable:
  url: https://github.com/quarylabs/sqruff/archive/refs/tags/{{  version.tag  }}.tar.gz
  strip-components: 1

versions:
  github: quarylabs/sqruff

build:
  dependencies:
    rust-lang.org/rustup: "*"
    rust-lang.org/cargo: "*"
  script:
    # from https://github.com/pkgxdev/pantry/blob/38f7b09a0c23800bc6d6e4904029e825cb16fd0f/projects/github.com/awslabs/llrt/package.yml#L27-L28
    # mkdir -p $HOME/.cargo/bin
    # ln -sf {{deps.rust-lang.org/rustup.prefix}}/bin/rustup $HOME/.cargo/bin/rustup
    # but don't think they are needed
    - rustup toolchain install nightly
    - cargo install sqruff --root {{prefix}}

provides:
  - bin/sqruff

test: test "$(sqruff -V)" = "sqruff {{version}}"
