distributable:
  url: https://github.com/maxmind/libmaxminddb/releases/download/{{version}}/libmaxminddb-{{version}}.tar.gz
  strip-components: 1

versions:
  github: maxmind/libmaxminddb

build:
  dependencies:
    gnu.org/autoconf: "*"
    gnu.org/libtool: "*"
    curl.se: "*"
    gnu.org/patch: "*"
  script:
    # Declaring these functions causes compilation failure on macOS because sys/endian.h header already defined macros with the same name
    - run: curl -L https://patch-diff.githubusercontent.com/raw/maxmind/libmaxminddb/pull/419.diff | patch -p1
      if: ">=1.13<1.13.2"
    - ./configure $ARGS
    - make --jobs {{ hw.concurrency }} install
  env:
    ARGS:
      - --prefix="{{prefix}}"
      - --disable-debug
      - --disable-dependency-tracking
      - --disable-silent-rules

provides:
  - bin/mmdblookup

test: mmdblookup --version | grep {{version}}
