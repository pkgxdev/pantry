distributable:
  url: https://github.com/git-ecosystem/git-credential-manager/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1

provides:
  - bin/git-credential-manager

versions:
  github: git-ecosystem/git-credential-manager/tags
  strip: /v/

platforms:
  - linux/x86-64

dependencies:
  dotnet.microsoft.com: "^8.0"
  gnu.org/gcc: ">=12"
  git-scm.org: "^2.27.0"
  kerberos.org: "^1.21.3"
  openssl.org: ">=1"
  unicode.org: "^71"
  zlib.net: "^1.3"

build:
  script: >
    dotnet build ${CSPROJ} -p:InstallFromSource=true -p:installPrefix={{prefix}}
    --no-self-contained --runtime=${RUNTIME} --configuration=${CONFIGURATION}
  env:
    DOTNET_CLI_TELEMETRY_OPTOUT: 1

    linux/x86-64:
      CSPROJ: src/linux/Packaging.Linux/*.csproj
      CONFIGURATION: LinuxRelease
      RUNTIME: linux-x64

    ## TODO: these are not working yet and I have no proper environment for
    ##       testing right now, so I leave them here for future reference.
    # linux/aarch64:
    #   CSPROJ: src/linux/Packaging.Linux/*.csproj
    #   CONFIGURATION: LinuxRelease
    #   RUNTIME: linux-arm64

    # darwin/x86-64:
    #   CSPROJ: src/osx/Installer.Mac/*.csproj
    #   CONFIGURATION: MacRelease
    #   RUNTIME: osx-x64

    # darwin/aarch64:
    #   CSPROJ: src/osx/Installer.Mac/*.csproj
    #   CONFIGURATION: MacRelease
    #   RUNTIME: osx-arm64

test: git-credential-manager --version | grep {{version}}