distributable:
  url: git+https://github.com/microsoft/DirectXShaderCompiler
  ref: v{{version}}

versions:
  github: microsoft/DirectXShaderCompiler/tags

build:
  dependencies:
    cmake.org: '*'
    git-scm.org: ^2
    ninja-build.org: ^1
    python.org: '>=3.7<3.12'
  script: |
    git submodule update --init
    cmake -B $BUILD_DIR $CMAKE_ARGS
    ninja -C $BUILD_DIR
  env:
    BUILD_DIR: $(mktemp -d)
    CMAKE_ARGS:
      - -GNinja
      - -C./cmake/caches/PredefinedParams.cmake
      - -DSPIRV_BUILD_TESTS=ON
      - -DLLVM_ENABLE_WERROR=On
      - -DCMAKE_INSTALL_PREFIX="{{prefix}}"
      - -DCMAKE_BUILD_TYPE=Release

provides:
  -  bin/dxc

test:
  script:
    dxc --help
