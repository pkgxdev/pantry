distributable:
  url: https://github.com/bcicen/ctop/archive/refs/tags/v{{version}}.tar.gz
  strip-components: 1

display-name: ctop

versions:
  github: bcicen/ctop

build:
  dependencies:
    go.dev: ^1.18
    git-scm.org: "*"

  script: |
    go mod download
    CGO_ENABLED="$CGO_ENABLED" go build -tags release -ldflags="$LDFLAGS" -o "$BUILDLOC"
  env:
    CGO_ENABLED: 0
    BUILDLOC: "{{prefix}}/bin/ctop"
    BUILD: "$(git rev-parse --short HEAD)"
    LDFLAGS:
      - -s
      - -w
      - -X main.version={{version}}
      - -X main.build="$BUILD"

provides:
  - bin/ctop

test: test "$(ctop -v | awk '{print $3}')" = {{version}},
