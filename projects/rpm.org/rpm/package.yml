distributable:
  url: http://ftp.rpm.org/releases/rpm-{{version.major}}.{{version.minor}}.x/rpm-{{version}}.tar.bz2
  strip-components: 1

display-name: rpm

versions:
  github: rpm-software-management/rpm
  strip:
    - /^rpm-/
    - /-release$/

dependencies:
  lua.org: ^5.2
  gnu.org/gmp: "*"
  libarchive.org: "*"
  darwinsys.com/file: "*"
  rpm.org/popt: "*"
  gnu.org/readline: "*"
  sqlite.org: "*"
  tukaani.org/xz: "*"
  facebook.com/zstd: "*"
  fossies.org/libelf: "*"
  linux:
    elfutils.org: "*"
  darwin:
    openmp.llvm.org: "*"
build:
  dependencies:
    cmake.org: ^3.18
    lua.org: "5.4"
    linux:
      gnu.org/gettext: "*"
  env:
    CMAKE_ARGS:
      - -DCMAKE_INSTALL_SYSCONFDIR={{prefix}}/etc
      - -DCMAKE_INSTALL_SHAREDSTATEDIR={{prefix}}/var/lib
      - -DCMAKE_INSTALL_LOCALSTATEDIR={{prefix}}/var
      - -DENABLE_NLS=ON
      - -DENABLE_PLUGINS=OFF
      - -DWITH_AUDIT=OFF
      - -DWITH_SELINUX=OFF
      - -DRPM_VENDOR=pkgx
      - -DENABLE_TESTSUITE=OFF
      - -DWITH_ACL=OFF
      - -DWITH_CAP=OFF
    darwin:
      LDFLAGS: $LDFLAGS -lomp
  working-directory: build
  script:
    - cmake .. $CMAKE_ARGS
    - cmake --build .
    - cmake --install .

provides:
  - bin/rpm

test: test "$(rpm --version)" = {{version}}
