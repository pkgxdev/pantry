distributable:
  url: https://github.com/qpdf/qpdf/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1

display-name: qpdf

versions:
  github: qpdf/qpdf

dependencies:
  zlib.net: ^1
  libjpeg-turbo.org: ^2
  openssl.org: ^1.1
  gnutls.org: ^3
  linux:
    gnu.org/gcc/libstdcxx: ^14 # needs newer libstdc++ for C++20 support

build:
  dependencies:
    cmake.org: ^3
    pyyaml.org/libyaml: "*"
    python.org: ^3
    pip.pypa.io: "*"
    linux:
      gnu.org/gcc: ^14
  working-directory: build
  script:
    # requires pyyaml to build
    - python -m venv venv
    - source venv/bin/activate
    - pip install pyyaml

    - cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1
      -DMAINTAINER_MODE=1
      -DBUILD_STATIC_LIBS=0
      -DCMAKE_INSTALL_PREFIX={{ prefix }}
      -DCMAKE_BUILD_TYPE=Release
      -DBUILD_DOC=0
      -DCMAKE_CXX_STANDARD=20
      -DCMAKE_CXX_STANDARD_REQUIRED=ON
      ..
    - cmake --build .
    - cmake --install .

provides:
  - bin/qpdf

test: qpdf --version | grep {{version}}
