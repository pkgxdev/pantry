distributable:
  url: https://github.com/pkgxdev/pkgm/releases/download/{{ version.tag }}/pkgm-{{ version }}.tgz

versions:
  github: pkgxdev/pkgm

provides:
  - bin/pkgm

dependencies:
  pkgx.sh: ^2
  curl.se/ca-certs: '*'

build:
  - install -Dm755 pkgm {{prefix}}/bin/pkgm

test:
  - pkgm --version | grep {{version}}
  - |
      if [ $(uname) = Darwin ]; then
        pkgm local-install dua
      else
        pkgm install dua
      fi
    # ^^ our self hosted macs cannot need sudo and cannot run sudo
  - pkgm ls | grep dua
  - PATH=/usr/local/bin:$HOME/.local/bin:$PATH command -v dua
  # ^^ brewkit PATH removes /usr/local/bin
  - PATH=/usr/local/bin:$HOME/.local/bin:$PATH dua --version
  - pkgm uninstall dua
