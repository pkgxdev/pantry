distributable:
  url: https://github.com/pkgxdev/pkgm/releases/download/{{ version.tag }}/pkgm-{{ version }}.tgz

versions:
  github: pkgxdev/pkgm

provides:
  - bin/pkgm

dependencies:
  pkgx.sh: ^2
  curl.se/ca-certs: '*'

build:
  - sed -i 's|--allow-run=pkgx,/usr/bin/sudo|--allow-run|' pkgm
  - head -n1 pkgm
  - install -Dm755 pkgm {{prefix}}/bin/pkgm

test:
  - pkgm --version
  - command -v pkgm
  - command -v pkgx
  - pkgx --version
  - head -n1 {{prefix}}/bin/pkgm
  - pkgm install dua
  - pkgm ls | grep dua
  - PATH=/usr/local/bin:$PATH command -v dua
  # ^^ brewkit PATH removes /usr/local/bin
  - PATH=/usr/local/bin:$PATH dua --version
  - pkgm uninstall dua
