distributable:
  url: https://github.com/pkgxdev/brewkit/archive/refs/tags/v{{ version }}.tar.gz
  strip-components: 1

display-name: brewkit

versions:
  github: pkgxdev/brewkit

dependencies:
  deno.land: ^1.37
  gnu.org/bash: ^5
  pkgx.sh: ^1

provides:
  - bin/bk

build: |
  mkdir -p {{prefix}}

  for x in bin libexec lib share deno.*; do
    test -e $x && mv $x "{{prefix}}"
  done

test:
    # • this is a fix for CI/CD considering brewkit is running tests for brewkit
    #   inside its own sandbox and our sandbox directories have unicode characters
    #   which break Ruby 2 which is what we are sadly using for the fix-machos
    #   part of brewkit’s build process
    # • the fix is necessary because tests define HOME to be inside the
    #   brewkit testbed which contains exoctic unicode characters. the fix
    #   macho script then sees these characters while fixing rpath and other
    #   macho entities
  - |
    if [ -n "$GITHUB_ACTIONS" ]; then
      export PKGX_DIR=/opt/.pkgx
    fi
  - bk build taglib.org
  - bk test taglib.org
