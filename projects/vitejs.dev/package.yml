distributable: https://github.com/vitejs/vite/archive/refs/tags/v{{version.raw}}.tar.gz

versions:
  github: vitejs/vite/tags
  strip: /v/

dependencies:
  pnpm.io: "*"
  nodejs.org: ^18
  npmjs.com: "*"

build:
  script: |
    cd vite-{{version.raw}}
    mkdir -p {{prefix}}/bin
    pnpm install
    cd packages/vite
    pnpm run build
    npm install --global --build-from-source --prefix={{prefix}} .

test:
  script: |
    export PATH="$PATH:{{pkgx.prefix}}/vitejs.dev/v*/bin"
    ls -la {{pkgx.prefix}}/vitejs.dev/v*/bin/
    vite --version
    test "$(vite --version | grep -o 'vite/[^ ]*')" = "vite/{{version.raw}}"

provides:
  - bin/vite
