distributable:
  url: https://registry.npmjs.org/vite/-/vite-{{version}}.tgz
  strip-components: 1

versions:
  github: vitejs/vite/tags
  strip: /v/

dependencies:
  nodejs.org: ^16 || ^18 || ^20

build:
  npm install .
    --global
    --build-from-source
    --install-links
    --prefix="{{prefix}}"

test:
  dependencies:
    darwinsys.com/file: '*'
    linux:
      strace.io: '*'
  script:
    - ls -l "{{prefix}}/bin"
    - file "{{prefix}}/bin/vite"
    - run: strace vite --version
      if: linux
    - vite --version
    - test "$(vite --version | grep -o 'vite/[^ ]*')" = "vite/{{version.raw}}"

provides:
  - bin/vite
