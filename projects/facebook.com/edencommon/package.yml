distributable:
  url: https://github.com/facebookexperimental/edencommon/archive/v2023.06.19.00.tar.gz
  strip-components: 1

versions:
  github: facebookexperimental/edencommon/tags

dependencies:
  facebook.com/folly: '*'
  gflags.github.io: '*'
  google.com/glog: '*'
  boost.org: '*'
  openssl.org: '*'

build:
  dependencies:
    tea.xyz/gx/cc: c99
    tea.xyz/gx/make: '*'
    cmake.org: '*'
    google.com/googletest: '*'

  script:
    - run: |
        cat << EOF >> CMakeLists.txt
        set(Boost_INCLUDE_DIR {{deps.boost.org.prefix}})
        set(Boost_LIBRARY_DIR {{deps.boost.org.prefix}}/lib)
        include_directories(\${Boost_INCLUDE_DIR})
        link_directories(\${Boost_LIBRARY_DIR})
        EOF
    - cmake -S . -B _build $ARGS
    - cmake --build _build
    - cmake --install _build
  env:
    ARGS:
      - -DBUILD_SHARED_LIBS=ON
      - -DCMAKE_INSTALL_PREFIX={{prefix}}
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_VERBOSE_MAKEFILE=ON
      - -Wno-dev
      - -DCMAKE_CXX_COMPILER="{{deps.tea.xyz/gx/cc.prefix}}/bin/c++"
      - -DCMAKE_CC_COMPILER="{{deps.tea.xyz/gx/cc.prefix}}/bin/cc"

test:
  dependencies:
    tea.xyz/gx/cc: c99
  script: |
    g++ -std=c++17 test.cc -o test -ledencommon_utils -lfolly
    ./test | grep test