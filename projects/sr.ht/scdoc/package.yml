distributable:
  url: https://git.sr.ht/~sircmpwn/scdoc/archive/{{version}}.tar.gz
  strip-components: 1

versions:
  url: https://git.sr.ht/~sircmpwn/scdoc/refs
  match: /scdoc\/archive\/\d+(\.\d+)+\.tar\.gz/
  strip:
    - /scdoc\/archive\//
    - /\.tar\.gz/

build:
  script:
    - make --jobs {{ hw.concurrency }} $ARGS
    - make install $ARGS
  env:
    ARGS:
      - PREFIX="{{prefix}}"
      - LDFLAGS="$LDFLAGS"

provides:
  - bin/scdoc

test:
  dependencies:
    gnu.org/diffutils: "*"
  script:
    - echo "" | (scdoc || true) | tee out
    - echo -e "" >> out
    - run: diff -u out $FIXTURE
      fixture: |
        .\" Generated by scdoc {{version}}
        .\" Complete documentation for this program is not available as a GNU info page
        .ie \n(.g .ds Aq \(aq
        .el       .ds Aq '
        .nh
        .ad l
        .\" Begin generated content:
