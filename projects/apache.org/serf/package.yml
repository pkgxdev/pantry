distributable:
  url: https://archive.apache.org/dist/serf/serf-{{version}}.tar.bz2
  strip-components: 1

display-name: serf

versions:
  url: https://archive.apache.org/dist/serf/
  match: /serf-(\d+\.\d+\.\d+)\.tar\.bz2/
  strip:
    - /serf-/
    - /.tar.bz2/

dependencies:
  apache.org/apr: ^1
  apache.org/apr-util: ^1
  openssl.org: ^1.1
  zlib.net: ^1.2
#  github.com/google/brotli: '*'
  kerberos.org: '*'

build:
  dependencies:
    python.org: ^3
    scons.org: '*'
    gnu.org/gcc: '*'
  script:
    #
    # available in trunk
    #        BROTLI={{deps.github.com/google/brotli.prefix}}
    - scons APR={{deps.apache.org/apr.prefix}}
            APU={{deps.apache.org/apr-util.prefix}}
            OPENSSL={{deps.openssl.org.prefix}}
            ZLIB={{deps.zlib.net.prefix}}
            GSSAPI={{deps.kerberos.org.prefix}}
            PREFIX={{prefix}}
    - scons install

test:
  dependencies:
    apache.org/apr: ^1
    apache.org/apr-util: ^1
    openssl.org: ^1.1
    zlib.net: ^1.2
    scons.org: '*'
    gnu.org/gcc: '*'
    curl.se: '*'
#    github.com/google/brotli: '*'
    kerberos.org: '*'
  script:
    - curl -O https://archive.apache.org/dist/serf/serf-{{version}}.tar.bz2
    #- curl {{distributable.url}}
    # ?? tar xvzf {{distributable.artifact}}
    - tar xvzf serf-{{version}}.tar.bz2
    - cd serf-{{version}}
    #
    # available in trunk
    #        BROTLI={{deps.github.com/google/brotli.prefix}}
    - scons APR={{deps.apache.org/apr.prefix}}
            APU={{deps.apache.org/apr-util.prefix}}
            OPENSSL={{deps.openssl.org.prefix}}
            ZLIB={{deps.zlib.net.prefix}}
            GSSAPI={{deps.kerberos.org.prefix}}
            check
