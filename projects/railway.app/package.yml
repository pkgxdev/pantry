distributable:
  url: git+https://github.com/railwayapp/cli.git
  ref: ${{version.tag}}

versions:
  github: railwayapp/cli

dependencies:
  gnu.org/libiconv: 1 # as of v4.27.5

build:
  dependencies:
    rust-lang.org: ^1.77
    rust-lang.org/cargo: "*"
  script:
    # 3.5.2 didn't bump version
    - run: sed -i 's/^version = ".*"$/version = "{{version}}"/' Cargo.toml
    - cargo add proc-macro2
    - cargo install $ARGS
  env:
    ARGS:
      - --root={{prefix}}
      - --path=.
      - --locked

provides:
  - bin/railway

test:
  env:
    RUST_BACKTRACE: full
  script:
    - railway init >out.stdout 2>out.log || true
    - cat out.stdout
    - cat out.log
    - railway --version | grep {{version}}
