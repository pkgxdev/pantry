distributable:
  url: https://git.kernel.org/pub/scm/libs/libcap/libcap.git/snapshot/libcap-{{version}}.tar.gz
  strip-components: 1

display-name: libcap

versions:
  url: https://git.kernel.org/pub/scm/libs/libcap/libcap.git/refs/
  match: /libcap-\d+\.\d+\.\d+\.tar\.gz/
  strip:
    - /^libcap-/
    - /.tar.gz$/

platforms:
  - linux

build:
  dependencies:
#    freedesktop.org/pkg-config: '*'
#    gnu.org/binutils: '*'
    cmake.org: ^3
#  env:
#    linux:
#      LD_PATH: $(which ld|sed 's/\//\\\//g')
  script:
    #- LD_PATH=$(which ld|sed 's/\//\\\//g')
    #- sed -i 's/\/usr\/bin\/ld/'${LD_PATH}'/' Make.Rules
#    - sed -i 's/\/usr\/bin\/ld/\/bin\/arch/' Make.Rules
#    - grep ld-linux Make.Rules
#    - exit 1
    - LIB=$lib=$(shell ldd /bin/*|grep -E "ld-linux|ld.so"|cut -d/ -f2|head -n1)
    - make prefix={{prefix}} sbin=bin lib=$LIB --jobs {{ hw.concurrency }} install
    #- mv {{prefix}}/sbin {{prefix}}/bin
    - run: ls -l
      working-directory: ${{prefix}}/${LIB}
    - run: ls -l
      working-directory: ${{prefix}}/bin

provides:
  - bin/capsh
  #- bin/captree
  - bin/getcap
  - bin/getpcaps
  - bin/setcap

test:
#  depedencies:
#    freedesktop.org/pkg-config: '*'
#    gnu.org/binutils: '*'
  script:
    - test "$(getpcaps --license|head -1)" = '--license see LICENSE file for details.'
