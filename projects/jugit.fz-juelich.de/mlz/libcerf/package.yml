distributable:
  url: https://jugit.fz-juelich.de/mlz/libcerf/-/archive/v{{version.marketing}}/libcerf-v{{version.marketing}}.tar.gz
  strip-components: 1
display-name: libcerf
versions:
  gitlab: jugit.fz-juelich.de:mlz/libcerf
build:
  dependencies:
    gnu.org/make: '*'
    cmake.org: '*'
    linux:
      gnu.org/gcc: '*'
  working-directory: build
  script:
    - cmake .. $ARGS
    - make --jobs {{ hw.concurrency }} install
  env:
    ARGS:
      - -DCMAKE_INSTALL_PREFIX={{prefix}}
      - -DCMAKE_INSTALL_LIBDIR={{prefix}}/lib
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_FIND_FRAMEWORK=LAST
      - -DCMAKE_VERBOSE_MAKEFILE=ON
      - -Wno-dev
    linux:
      ARGS:
        - -DCMAKE_C_COMPILER={{deps.gnu.org/gcc.prefix}}/bin/gcc
        - -DCMAKE_CXX_COMPILER={{deps.gnu.org/gcc.prefix}}/bin/g++
        - -DCMAKE_CXX_STANDARD=11
test:
  dependencies:
    linux:
      gnu.org/gcc: '*'
    freedesktop.org/pkg-config: '*'
  script:
    - cc test.c -lcerf -o test
    - ./test
    - pkg-config --modversion libcerf | grep {{version.marketing}}