distributable:
  url: https://github.com/git-lfs/git-lfs/releases/download/v{{version}}/git-lfs-v{{version}}.tar.gz
  strip-components: 1

versions:
  github: git-lfs/git-lfs

dependencies:
  git-scm.org: '*'
  
build:
  dependencies:
    tea.xyz/gx/cc: c99
    tea.xyz/gx/make: '*'
    gnu.org/wget: '*'
  
  working-directory: build
  script:
    - wget "$DOWNLOAD_URL/$DOWNLOAD_FILE"
    - tar -xz --strip-components=1 -f $DOWNLOAD_FILE
    - mkdir -p {{prefix}}/bin
    - install ./git-lfs {{prefix}}/bin/git-lfs
    - mkdir -p {{prefix}}/man
    - install ./man/* {{prefix}}/man/

  env:
    DOWNLOAD_URL: https://github.com/git-lfs/git-lfs/releases/download/v{{version}}
    linux/x86-64:
      DOWNLOAD_FILE: git-lfs-linux-amd64-v{{version}}.tar.gz
    linux/aarch64:
      DOWNLOAD_FILE: git-lfs-linux-arm64-v{{version}}.tar.gz
    darwin/x86-64:
      DOWNLOAD_FILE: git-lfs-darwin-amd64-v{{version}}.tar.gz
    darwin/aarch64:
      DOWNLOAD_FILE: git-lfs-darwin-arm64-v{{version}}.tar.gz
    VERSION: "{{version}}"

provides:
  - bin/git-lfs

test:
  - git init
  - git lfs track test
  - grep 'test filter=lfs' .gitattributes