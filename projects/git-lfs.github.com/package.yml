distributable:
  url: https://github.com/git-lfs/git-lfs/releases/download/v{{version}}/git-lfs-v{{version}}.tar.gz
  strip-components: 1

versions:
  github: git-lfs/git-lfs

dependencies:
  git-scm.org: '*'
  go.dev: '*'

build:
  dependencies:
    tea.xyz/gx/cc: c99
    tea.xyz/gx/make: '*'
    asciidoctor.org: '*'
    rtomayko.github.io/ronn: '*'
    ruby-lang.org: '*'
    go.dev: '*'
  
  script:
    - make
    - make man RONN={{deps.rtomayko.github.io/ronn.prefix}}/bin/ronn
    - mkdir -p {{prefix}}/bin
    - install ./bin/git-lfs "{{prefix}}/bin/git-lfs"
    - mkdir -p {{prefix}}/man
    - mv ./man/* {{prefix}}/man/
    # Update your git config to finish installation:
    #   Update global git config
    #     $ git lfs install
    #   Update system git config
    #     $ git lfs install --system

  env:
    VERSION: "{{version}}"

provides:
  - bin/git-lfs

test:
  working-directory: test
  script:
    - git lfs install --force
    - git init
    - git lfs track test
    - grep 'test filter=lfs' .gitattributes
