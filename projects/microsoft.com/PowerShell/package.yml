distributable:
  url: https://github.com/PowerShell/PowerShell/archive/v{{version}}.tar.gz
  strip-components: 1

versions:
  github: PowerShell/PowerShell/tags
  strip:
    - /^v/

interprets:
  extensions:
    - ps1
    - ps1xml
    - psc1
    - psd1
    - psm1
    - pssc
    - psrc
    - cdxml
  args: pwsh

dependencies:
  openssl.org: '^1.1'
  linux:
    unicode.org: ^71

warnings:
  - vendored

build:
  dependencies:
    curl.se: '*'
  working-directory: ${{prefix}}
  script:
    - curl -L "https://github.com/PowerShell/PowerShell/releases/download/v${VERSION}/powershell-${VERSION}-${PLATFORM}.tar.gz" | tar zxf -
    - chmod +x pwsh
    - mkdir bin
    - cd bin
    - ln -s "../pwsh" ./pwsh
  env:
    VERSION: "{{version}}"
    PREFIX: "{{prefix}}"
    darwin/aarch64: { PLATFORM: osx-arm64 }
    darwin/x86-64:  { PLATFORM: osx-x64 }
    linux/aarch64:  { PLATFORM: linux-arm64 }
    linux/x86-64:   { PLATFORM: linux-x64 }

provides:
  - bin/pwsh

test:
  script:
    - test "$(pwsh --version)" = "PowerShell {{version}}"
