distributable:
  url: https://github.com/helm/helm/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1

versions:
  github: helm/helm/releases/tags

provides:
  - bin/helm

build:
  dependencies:
    go.dev: ^1.19
  script:
    - run: sed -i -f $PROP Makefile
      prop: |
        s/unreleased//g
        s/\(shell find . .* -print\)/\1 | grep -v dev.pkgx./
    - mkdir -p "{{prefix}}/bin"
    - make install VERSION=v{{version}} INSTALL_PATH="{{prefix}}/bin"

test:
  - helm create foo
  - test -d "foo/charts"
  - helm version | grep "Version:\"v{{version}}\""
