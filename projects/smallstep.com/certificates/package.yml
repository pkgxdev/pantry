# vendored
# distributable:
#   url: git+https://github.com/smallstep/certificates
#   ref: v{{version}}

warnings:
  - vendored

versions:
  github: smallstep/certificates/tags
  strip: /^v/

provides:
  - bin/step-ca

build:
  dependencies:
    curl.se: '*'
    gnu.org/tar: '*'
  working-directory: ${{prefix}}/bin
  script:
    - curl -L "https://github.com/smallstep/certificates/releases/download/{{version.tag}}/step-ca_${PLATFORM}_${ARCH}.tar.gz" | tar zxf -
    - mv step-ca_${PLATFORM}_${ARCH}/step-ca step-ca
    - rm -rf step-ca_${PLATFORM}_${ARCH}
  env:
    CGO_ENABLED: 0
    darwin/aarch64: {PLATFORM: darwin, ARCH: arm64}
    darwin/x86-64:  {PLATFORM: darwin, ARCH: amd64}
    linux/aarch64:  {PLATFORM: linux, ARCH: arm64}
    linux/x86-64:   {PLATFORM: linux, ARCH: amd64}

test:
  script:
    - step-ca version | grep -q {{version}}
