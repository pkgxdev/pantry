distributable:
  url: https://github.com/opentofu/opentofu/archive/refs/tags/v1.6.0-alpha3.tar.gz
  strip-components: 1
versions:
  # github: opentofu/opentofu
  # 1.6.0-alpha3
  - '1.6.0.3'
dependencies:
  linux:
    # Needs libraries at runtime:
    # /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by node)
    gnu.org/gcc: '*'
build:
  dependencies:
    go.dev: '*'
  script:
    - go build $GO_ARGS -ldflags="$LD_FLAGS" ./cmd/tofu
  env:
    GO_ARGS:
      - -o="{{prefix}}/bin/"
    LD_FLAGS:
      - -s
      - -w
    linux:
      CGO_ENABLED: 0
provides:
  - bin/tofu
test:
  script:
    - mv $FIXTURE ./minimal.tf
    - tofu init
    - tofu graph
    - tofu --version | grep {{version.marketing}}
  env:
    TFOFU_PROVIDER_REGISTRY: https://releases.hashicorp.com/terraform/providers
  fixture: |
    terraform {
      required_providers {
        tfcoremock = {
          source  = "hashicorp/tfcoremock"
          version = "0.1.1"
        }
      }
    }

    provider "tfcoremock" {}

    resource "tfcoremock_nested_list" "nested_list" {
      id = "DA051126-BAD6-4EB2-92E5-F0250DAF0B92"

      lists = [
        [],
        ["44E1C623-7B70-4D78-B4D3-D9CFE8A6D982"],
        ["13E3B154-7B85-4EAA-B3D0-E295E7D71D7F", "8B031CD1-01F7-422C-BBE6-FF8A0E18CDFD"],
      ]
    }
