distributable:
  #FIXME This is hard-coded, because that's the only way to get it to work.
  url: https://github.com/opentofu/opentofu/archive/refs/tags/v1.6.0-alpha3.tar.gz
  strip-components: 1

versions:
  #FIXME OpenTofu has no stable version (yet). The latest version is v1.6.0-alpha3 (as of 23rd of October). But Brewkit doesn't (yet) support versions like so.
  - "1.6.0"

linux:
    # Needs libraries at runtime:
    # /usr/lib/x86_64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.29' not found (required by node)
    gnu.org/gcc: '*'

build:
  dependencies:
    go.dev: ^1
  env:
    GOBIN: "{{prefix}}/bin"
    LDFLAGS:
      - -s
      - -w
      - -X 'github.com/opentofu/opentofu/version.dev=no'
    CGO_ENABLED: 1
    linux:
        # or segmentation fault
        # fix found here https://github.com/docker-library/golang/issues/402#issuecomment-982204575
        LDFLAGS:
          - -buildmode=pie
        CGO_ENABLED: 0
  working-directory: cmd/tofu
  script: go install -ldflags="$LDFLAGS"

test:
  script: |
    test "$(tofu --version | grep {{version.raw}})" = "OpenTofu v{{version.raw}}"

provides:
  - bin/tofu