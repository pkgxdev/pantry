distributable:
  url: https://deb.debian.org/debian/pool/main/i/iso-codes/iso-codes_{{version}}.orig.tar.xz
  strip-components: 1

versions:
  url: https://deb.debian.org/debian/pool/main/i/iso-codes/
  match: /iso-codes_\d+\.\d+\.\d+\.orig\.tar\.xz/
  strip:
    - /^iso-codes_/
    - /\.orig\.tar\.xz/

dependencies:
  gnu.org/gettext: "*"

build:
  dependencies:
    python.org: "<3.12"
    mesonbuild.com: "*" # as of 4.20.1
    ninja-build.org: "*" # as of 4.20.1
  script:
    - run:
        - ./configure $CONFIGURE_ARGS
        - make --jobs {{hw.concurrency}}
        - make --jobs {{hw.concurrency}} install
      if: <4.20.1
    - run:
        - meson setup build ${MESON_ARGS}
        - meson compile -C build --jobs {{hw.concurrency}}
        - meson install -C build
      if: ">=4.20.1"
  env:
    MESON_ARGS:
      - --strip
      - --buildtype=release
      - --prefix={{prefix}}
      - --libdir={{prefix}}/lib
    CONFIGURE_ARGS:
      - --disable-debug
      - --disable-dependency-tracking
      - --prefix="{{prefix}}"
      - --libdir="{{prefix}}/lib"

test:
  dependencies:
    freedesktop.org/pkg-config: "*"
  script:
    - pkg-config --modversion iso-codes | tee out
    - grep {{version}} out
    - pkg-config --variable=domains iso-codes | tee out
    - for x in iso_639-2 iso_639-3 iso_639-5 iso_3166-1 iso_3166-2 iso_3166-3 iso_4217 iso_15924; do
    - grep $x out
    - done
