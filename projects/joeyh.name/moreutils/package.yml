distributable:
  url: https://github.com/pgdr/moreutils/archive/refs/tags/{{version.raw}}.tar.gz
  strip-components: 1

display-name: moreutils

versions:
  github: pgdr/moreutils/tags

dependencies:
  perl.org: '*'

build:
  dependencies:
    cmake.org: ^3
    gnome.org/libxslt: '*'
    docbook.org/xsl: '*'
  env:
    PREFIX: "{{ prefix }}"
    DOCBOOKXSL: "{{ deps.docbook.org/xsl.prefix }}/libexec/docbook-xsl"
  script: |
    make --jobs {{ hw.concurrency }}
    make install

provides:
  - bin/chronic
  - bin/combine
  - bin/errno
  - bin/ifdata
  - bin/ifne
  - bin/lckdo
  - bin/mispipe
  - bin/parallel
  - bin/pee
  - bin/sponge
  - bin/ts
  - bin/vidir
  - bin/vipe
  - bin/zrun

test:
  dependencies:
    gnu.org/coreutils: '*'
    stedolan.github.io/jq: ^1.6

  script: |
    jq --null-input \
       'type|if "null" then {A:3} else .+={A:3} end' db.json \
    | sponge db.json
    cat db.json
