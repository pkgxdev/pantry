distributable:
  url: https://github.com/Tencent/rapidjson/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1

versions:
  github: Tencent/rapidjson/tags

build:
  dependencies:
    cmake.org: 3
    doxygen.nl: 1
    gnu.org/patch: "*"
  script:
    - patch -p1 < props/gcc-clang.patch
    - cmake . $ARGS
    - sed -i -e "s/-march=native//" -e "s/-Werror//" CMakeLists.txt
    - make . install
  env:
    ARGS:
      - -DCMAKE_BUILD_TYPE=Release
      - -DCMAKE_INSTALL_PREFIX={{prefix}}
      - -DRAPIDJSON_BUILD_EXAMPLES=OFF

test:
  - c++ ./capitalize.cpp -o capitalize
  - test $(echo '{"a":"b"}' | ./capitalize) = '{"A":"B"}'
