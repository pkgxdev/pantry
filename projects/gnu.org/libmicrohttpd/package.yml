distributable:
  url: https://ftp.gnu.org/gnu/libmicrohttpd/libmicrohttpd-{{version}}.tar.gz
  strip-components: 1

versions:
  url: https://ftp.gnu.org/gnu/libmicrohttpd/
  match: /libmicrohttpd-\d+\.\d+\.\d+\.tar\.gz/
  strip:
    - /^libmicrohttpd-/
    - /\.tar\.gz$/

dependencies:
  gnutls.org: ^3.8

build:
  script:
    - ./configure $ARGS
    - make --jobs {{ hw.concurrency }} install
  env:
    ARGS:
      - --disable-dependency-tracking
      - --disable-silent-rules
      - --enable-https
      - --prefix={{prefix}}

test:
  - cc simplepost.c -lmicrohttpd -o test
  - ./test > output.log &
  - sleep 1
  - cat output.log | grep daemon