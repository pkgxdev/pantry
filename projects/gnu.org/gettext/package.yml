distributable:
  url: https://ftp.gnu.org/gnu/gettext/gettext-{{version.raw}}.tar.gz
  strip-components: 1

dependencies:
  gnome.org/libxml2: ~2.13 # 2.14 changes the API
  #TODO ncurses
  tukaani.org/xz: 5 # autopoint needs this to unpack archives
  gnu.org/libiconv: "*" # as of v1.0.0

versions:
  github: autotools-mirror/gettext/tags

build:
  script:
    - ./configure $ARGS
    - make --jobs {{ hw.concurrency }}
    - make install

    - run: sed -i 's|{{prefix}}|"$(cd "$(dirname "$0")/.." \&\& pwd)"|' gettextize autopoint
      working-directory: ${{prefix}}/bin
    - run: find . -name \*.la -exec rm -f {} \;
      working-directory: ${{prefix}}/lib
  env:
    ARGS:
      - --prefix={{ prefix }}
      - --disable-debug
      - --with-included-debug
      - --with-included-libcroco
      - --with-included-libunistring
      - --without-included-libxml
      - --disable-java
      - --disable-csharp

test: gettext test

provides:
  - bin/autopoint
  - bin/envsubst
  - bin/gettext
  - bin/gettext.sh
  - bin/gettextize
  - bin/msgattrib
  - bin/msgcat
  - bin/msgcmp
  - bin/msgcomm
  - bin/msgconv
  - bin/msgen
  - bin/msgexec
  - bin/msgfilter
  - bin/msgfmt
  - bin/msggrep
  - bin/msginit
  - bin/msgmerge
  - bin/msgunfmt
  - bin/msguniq
  - bin/ngettext
  - bin/recode-sr-latin
  - bin/xgettext
