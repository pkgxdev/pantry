distributable:
  url: https://download.gnome.org/sources/gtk/{{version.marketing}}/gtk-{{version}}.tar.xz
  strip-components: 1

versions:
  - 4.12.3

display-name: gtk4

dependencies:
  

build:
  dependencies:
    docbook.org: '*'
    docbook.org/xsl: '*'
    gnu.org/gettext: '*'
    gnome.org/gobject-introspection: '*'
    mesonbuild.com: '*'
    ninja-build.org: '*'
    linux:
      cmake.org: '*'
  script:
    - meson setup build $MESON_ARGS
    - meson compile -C build --verbose
    - meson install -C build
  env:
    MESON_ARGS:
      - --prefix="{{prefix}}"
      - --libdir="{{prefix}}/lib"
      - --buildtype=release
      - --wrap-mode=nofallback
      - -Dgtk_doc=false
      - -Dman-pages=true
      - -Dintrospection=enabled
      - -Dbuild-examples=false
      - -Dbuild-tests=false
      - -Dmedia-gstreamer=disabled
    darwin:
      MESON_ARGS:
        - -Dx11-backend=false
        - -Dmacos-backend=true
    DESTDIR: /
    XML_CATALOG_FILES: "{{prefix}}/etc/xml/catalog"
    CPPFLAGS:
      - -DG_DISABLE_ASSERT
      - -DG_DISABLE_CAST_CHECKS

provides:
  - bin/gtk-builder-tool
  - bin/gtk-encode-symbolic-svg
  - bin/gtk-launch
  - bin/gtk-query-immodules-3.0
  - bin/gtk-query-settings
  - bin/gtk-update-icon-cache
  - bin/gtk3-demo
  - bin/gtk3-demo-application
  - bin/gtk3-icon-browser
  - bin/gtk3-widget-factory

test:
  dependencies:
    freedesktop.org/pkg-config: '*'
  script:
    - pkg-config --modversion gtk+-3.0 | grep {{version}}
    - cc test.c $(pkg-config --cflags --libs gtk+-3.0) -o test
    - ./test
