distributable:
  url: https://github.com/AcademySoftwareFoundation/openexr/archive/refs/tags/v{{version}}.tar.gz
  strip-components: 1

versions:
  github: AcademySoftwareFoundation/openexr/tags
  strip: /^v/

dependencies:
  zlib.net: ^1
  openexr.com/imath: "*"
  linux:
    gnu.org/gcc/libstdcxx: 14 # needed since 3.4.0

build:
  dependencies:
    cmake.org: "*"
    git-scm.org: "*"
    linux:
      kernel.org/linux-headers: "*" # needs HWCAP2_SVE2 for aarch64 since 3.4.0
      gnu.org/gcc: 14
  working-directory: build
  script:
    - cmake .. $ARGS
    - make install
  env:
    ARGS:
      - -DCMAKE_INSTALL_PREFIX="{{prefix}}"
      - -DCMAKE_BUILD_TYPE=Release
    linux:
      ARGS:
        # since 3.3.0
        - -DCMAKE_EXE_LINKER_FLAGS="-Wl,-lstdc++fs"

provides:
  - bin/exr2aces
  - bin/exrenvmap
  - bin/exrheader
  - bin/exrmakepreview
  - bin/exrmaketiled
  - bin/exrmultipart
  - bin/exrmultiview
  - bin/exrstdattr

test:
  dependencies:
    gnu.org/wget: "*"
  script: |
    wget https://github.com/AcademySoftwareFoundation/openexr-images/raw/main/TestImages/AllHalfValues.exr
    exrheader AllHalfValues.exr
