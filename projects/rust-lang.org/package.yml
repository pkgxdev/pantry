distributable:
  url: https://static.rust-lang.org/dist/rustc-{{ version }}-src.tar.gz
  strip-components: 1

versions:
  github: rust-lang/rust
  strip: /^Rust /

companions:
  rust-lang.org/cargo: '*'

display-name: rust

provides:
  - bin/cargo-clippy
  - bin/cargo-fmt
  - bin/clippy-driver
  - bin/rust-analyzer
  - bin/rust-gdb
  - bin/rust-gdbgui
  - bin/rust-lldb
  - bin/rustc
  - bin/rustfmt

#TODO: unimplemented idea for the “options” feature
options:
  - clippy
  - rustfmt
  - analysis
  - { name: rust-demangler, default: false }

dependencies:
  tea.xyz/gx/cc: c99

runtime:
  env:
    RUST_SRC_PATH: ${{prefix}}/lib/rustlib/src/rust/src

build:
  dependencies:
    rust-lang.org/rustup: '*'
  script: |-
    rustup default {{ version }}
    rustup component add rust-analyzer
    # used for type checking in IDEs
    rustup component add rust-src
    
    # copy installation
    mkdir -p {{ prefix }}
    cp -r ~/.rustup/toolchains/*/* {{prefix}}

    # do cleanup
    rm -rf {{prefix}}/share/doc

test:
  script: |
    mv $FIXTURE hello.rs
    rustc hello.rs
    ./hello
  fixture: |
    fn main() {
      println!("Hello World!");
    }
