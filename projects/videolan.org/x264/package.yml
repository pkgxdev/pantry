distributable:
  url: https://code.videolan.org/videolan/x264/-/archive/master/x264-master.tar.gz
  strip-components: 1

versions:
  - 0.164

build:
  dependencies:
    tea.xyz/gx/cc: c99
    gnu.org/gcc: '*'
    tea.xyz/gx/make: '*'
    nasm.us: '*'
  script: |
    ./configure $ARGS
    make --jobs {{ hw.concurrency }} install
  env:
    ARGS:
      - --prefix="{{prefix}}"
      - --disable-lsmash
      - --disable-swscale
      - --disable-ffms
      - --enable-shared
      - --enable-static
      - --enable-strip

provides:
  - bin/x264

test:
  dependencies:
      tea.xyz/gx/cc: c99
  script: |
    cc test.c -lx264 -o test
    ./test
    x264 --version | grep {{ version.marketing }}
