distributable:
  - url: https://download.videolan.org/videolan/libbluray/{{version}}/libbluray-{{version}}.tar.xz
    strip-components: 1
  - url: https://download.videolan.org/videolan/libbluray/{{version}}/libbluray-{{version}}.tar.bz2
    strip-components: 1

versions:
  url: http://download.videolan.org/videolan/libbluray/
  match: /\d+\.\d+\.\d+\//
  strip:
    - /\/$/

dependencies:
  freedesktop.org/fontconfig: '*'
  freetype.org: '*'
  darwin:
    gnome.org/libxml2: ~2.13 # API changed in 2.14

build:
  dependencies:
    gnu.org/automake: '*'
    gnu.org/autoconf: '*'
    gnu.org/libtool: '*'
    # since 1.4.0
    mesonbuild.com: ^1
    ninja-build.org: ^1
  script:
    - run:
        - ./bootstrap
        - ./configure $ARGS
        - make
        - make install
      if: <1.4
    - run:
        - meson setup build $MESON_ARGS
        - meson compile -C build
        - meson install -C build
      if: '>=1.4'
  env:
    ARGS:
      - --prefix={{prefix}}
      - --disable-dependency-tracking
      - --disable-silent-rules
      - --disable-bdjava-jar
    MESON_ARGS:
      - --prefix={{prefix}}
      - -Dbdj_jar=disabled

test:
  - cc test.c -lbluray -o test
  - ./test
