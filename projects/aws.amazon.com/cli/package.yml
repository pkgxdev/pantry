distributable:
  url: https://github.com/aws/aws-cli/archive/{{version}}.tar.gz
  strip-components: 1

display-name: aws/cli

versions:
  github: aws/aws-cli/tags

dependencies:
  sourceware.org/libffi: ^3
  pkgx.sh: ">=1"

build:
  dependencies:
    rust-lang.org: ">=1.48.0" # needed for cryptography
    rust-lang.org/cargo: "*"
    python.org: ">=3.7<3.12"
  script:
    - bkpyvenv stage {{prefix}} {{version}}
    - ${{prefix}}/venv/bin/pip install .
    - bkpyvenv seal {{prefix}} aws
  env:
    # python includes are subdirectoried under the version
    # frankly, python's versioning system causes a lot of
    # issues for us despite its similarities to our own,
    # due to versioning at the end of the path tree,
    # instead of the beginning.
    CPATH: $CPATH:{{deps.python.org.prefix}}/include/python{{deps.python.org.version.marketing}}

test:
  # Pretty much anything else appears to require AWS credentials
  aws --version

provides:
  - bin/aws
