distributable:
  url: https://curl.se/download/curl-{{version}}.tar.bz2
  strip-components: 1

display-name: cURL

versions:
  github: curl/curl/releases
  strip: /^curl /
  # 8.18 requires opensslv3
  # TODO: make another package for curl with openssl3
  ignore:
    - /8\.1[8-9]\..*/
    - /8\.2\d\..*/
    - /9\.\d+\.\d+/

dependencies:
  openssl.org: ^1.1
  curl.se/ca-certs: "*"
  zlib.net: ^1.2.11

build:
  script:
    - ./configure $ARGS
    - make --jobs {{ hw.concurrency }} install
  env:
    ARGS:
      - --prefix={{prefix}}
      - --with-openssl
      # causes weird downstream bugs in php
      - --without-libpsl
      # uses opensslâ€™s certs (which we control)
      - --with-ca-fallback

test:
  - curl -i pkgx.sh
  - curl --proto '=https' --tlsv1.2 -sSf https://get-ghcup.haskell.org

provides:
  - bin/curl
  - bin/curl-config
