distributable:
  url: https://download.qt.io/official_releases/qt/{{version.marketing}}/{{version}}/single/qt-everywhere-opensource-src-{{version}}.tar.xz
  strip-components: 1
versions:
  - 5.15.10
dependencies:
  freetype.org: '*'
  gnome.org/glib: '*'
  libjpeg-turbo.org: '*'
  libpng.org: '*'
  pcre.org/v2: '*'
  google.com/webp: '*'
  gnu.org/bison: '*'
  github.com/westes/flex: '*'
  kerberos.org: '*'
  gnome.org/libxslt: '*'
  sqlite.org: '*'
  linux:
    alsa-project.org/alsa-lib: '*'
    freedesktop.org/fontconfig: '*'
    harfbuzz.org: '*'
    unicode.org: ~71
    dri.freedesktop.org: '*'
    libevent.org: '*'
    x.org/ice: '*'
    x.org/sm: '*'
    webmproject.org/libvpx: '*'
    x.org/xcomposite: '*'
    xkbcommon.org: '*'
    x.org/xkbfile: '*'
    x.org/xrandr: '*'
    x.org/xtst: '*'
    mesa3d.org: '*'
    zlib.net/minizip: '*'
    mozilla.org/nss: '*'
    opus-codec.org: '*'
    libsdl.org: '*'
    google.github.io/snappy: '*'
    systemd.io: '*'
    wayland.freedesktop.org: '*'
    freedesktop.org/xcb-util: '*'
    freedesktop.org/xcb-util-image: '*'
    freedesktop.org/xcb-util-keysyms: '*'
    freedesktop.org/xcb-util-renderutil: '*'
    freedesktop.org/xcb-util-wm: '*'
    facebook.com/zstd: '*'
build:
  dependencies:
    nodejs.org: '*'
    freedesktop.org/pkg-config: '*'
    python.org: ^3.10
    gnu.org/gperf: '*'
    linux:
    #   gnu.org/gcc: '*'
      gnu.org/make: '*'
  script:
    - ./configure $ARGS
    - make --jobs {{hw.concurrency}}
    - make -j1 install
  env:
    CFLAGS: "$CFLAGS -Wl,-rpath,{{pkgx.prefix}}"
    CXXFLAGS: "$CXXFLAGS -Wl,-rpath,{{pkgx.prefix}}"
    LDFLAGS: "$LDFLAGS -Wl,-rpath,{{pkgx.prefix}}"
    ARGS:
      - -verbose
      - -prefix {{prefix}}
      - -release
      - -opensource -confirm-license
      - -nomake examples
      - -nomake tests
      - -pkg-config
      - -dbus-runtime
      - -proprietary-codecs
      - -system-freetype
      - -system-libjpeg
      - -system-libpng
      - -system-pcre
      - -system-zlib
    linux:
      ARGS:
        - -R{{prefix}}/lib
        - -no-avx2
        - -no-avx512
        - -no-sql-mysql
        - -platform linux-clang
    # darwin:
    #   ARGS:
    #     - -no-rpath
    darwin/aarch64:
      ARGS:
        - -no-assimp
provides:
  - bin/assistant
  - bin/balsam
  - bin/canbusutil
  - bin/designer
  - bin/lconvert
  - bin/linguist
  - bin/lprodump
  - bin/lrelease
  - bin/lrelease-pro
  - bin/lupdate
  - bin/lupdate-pro
  - bin/meshdebug
  - bin/moc
  - bin/pixeltool
  - bin/qcollectiongenerator
  - bin/qdbus
  - bin/qdbuscpp2xml
  - bin/qdbusviewer
  - bin/qdbusxml2cpp
  - bin/qdistancefieldgenerator
  - bin/qdoc
  - bin/qgltf
  - bin/qhelpgenerator
  - bin/qlalr
  - bin/qmake
  - bin/qml
  - bin/qmlcachegen
  - bin/qmleasing
  - bin/qmlformat
  - bin/qmlimportscanner
  - bin/qmllint
  - bin/qmlmin
  - bin/qmlplugindump
  - bin/qmlpreview
  - bin/qmlprofiler
  - bin/qmlscene
  - bin/qmltestrunner
  - bin/qmltime
  - bin/qmltyperegistrar
  - bin/qscxmlc
  - bin/qtattributionsscanner
  - bin/qtdiag
  - bin/qtpaths
  - bin/qtplugininfo
  - bin/qtwaylandscanner
  - bin/qvkgen
  - bin/rcc
  - bin/repc
  - bin/tracegen
  - bin/uic
  - bin/xmlpatterns
  - bin/xmlpatternsvalidator
test:
  script:
    - qmake hello.pro
    - make
    - ./hello
