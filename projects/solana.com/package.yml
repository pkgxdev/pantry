distributable:
  url: https://github.com/solana-labs/solana/archive/v{{version}}.tar.gz
  strip-components: 1

versions:
  github: solana-labs/solana

dependencies:
  protobuf.dev: ^21
  zlib.net: ^1.2
  openssl.org: ^1.1

build:
  dependencies:
    protobuf.dev: ^21
    rust-lang.org/cargo: '*'
    freedesktop.org/pkg-config: ^0.29
  script: |
    for x in \
      cli \
      bench-streamer \
      faucet \
      keygen \
      log-analyzer \
      net-shaper \
      stake-accounts \
      sys-tuner \
      tokens \
      watchtower
    do
      cargo install --locked --root {{prefix}} --path $x
    done

provides:
  - bin/solana
  - bin/solana-keygen
  - bin/solana-bench-streamer
  - bin/solana-faucet
  - bin/solana-keygen
  - bin/solana-log-analyzer
  - bin/solana-net-shaper
  - bin/solana-stake-accounts
  - bin/solana-sys-tuner
  - bin/solana-tokens
  - bin/solana-watchtower

test: |
  solana-keygen new --no-bip39-passphrase --no-outfile
  solana-keygen --version | grep {{version}}
