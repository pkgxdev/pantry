distributable:
  url: https://github.com/LuaJIT/LuaJIT/archive/v{{version}}.tar.gz
  strip-components: 1
versions:
  github: LuaJIT/LuaJIT/tags
build:
  dependencies:
    tea.xyz/gx/cc: c99
    gnu.org/make: '*'
  script:
    - make --jobs {{hw.concurrency}} amalg PREFIX={{prefix}}
    - make --jobs {{hw.concurrency}} install PREFIX={{prefix}}
    - mkdir -p {{prefix}}/doc
    - mv doc/* {{prefix}}/doc/
provides:
  - bin/luajit
  - bin/luajit-{{version}}
test:
  script:
    - luajit -v | grep {{version}}
    - luajit test.lua
    - touch empty.lua
    - luajit -b -o osx -a x64 empty.lua empty.o
    - ls | grep empty.o
