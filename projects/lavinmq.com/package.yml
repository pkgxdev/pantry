distributable:
  url: https://github.com/cloudamqp/lavinmq/archive/refs/tags/{{version.tag}}.tar.gz
  strip-components: 1

versions:
  github: cloudamqp/lavinmq

platforms:
  # - darwin  Deactivate for testing purposes
  - linux/x86-64  # TODO: ARM64 is not supported by package crystal-lang.org/shards

dependencies:
  openssl.org: ^1.1
  pcre.org/v2: 10
  hboehm.info/gc: 8

build:
  dependencies:
    gnu.org/make: ^4
    gnu.org/gcc: ^14
    crystal-lang.org: ~1.13
    crystal-lang.org/shards: ~0.18
    lz4.org: ^1
    gnu.org/help2man: '*'
    gnu.org/gettext: '*'
    perl.org: '5.38'
  script:
    - make install PREFIX="{{prefix}}"
  env:
    CRYSTAL_PATH: './lib:$CRYSTAL_PATH'
    MAKEFLAGS: '-j{{hw.concurrency}}'

provides:
  - bin/lavinmq
  - bin/lavinmqctl
  - bin/lavinmqperf

test: test "$(lavinmq --version)" = {{version}}
