distributable: https://github.com/PHP-CS-Fixer/PHP-CS-Fixer/releases/download/{{version.tag}}/php-cs-fixer.phar

versions:
  github: PHP-CS-Fixer/PHP-CS-Fixer

warnings:
  - vendored

dependencies:
  php.net: '>=7.4<8.4'

build:
  - install -D symfony.comâˆ•cs-{{version}}.phar {{prefix}}/libexec/lib/php-cs-fixer.phar
  - run: |
      cat > php-cs-fixer <<EOF
      #!/bin/sh
      exec php \$(dirname \$0)/../libexec/lib/php-cs-fixer.phar "\$@"
      EOF
      chmod +x php-cs-fixer
    working-directory: ${{prefix}}/bin

provides:
  - bin/php-cs-fixer

test:
  - php-cs-fixer --version | tee out
  - grep {{version}} out
  - run: cp $FIXTURE test.php
    fixture: "<?php $this->foo(   'Hello World!'   );"
  # first run creates the config file
  - run: php-cs-fixer fix test.php
    if: <3.91
  - run:
      - cp $FIXTURE composer.json
      # first run makes a config
      - php-cs-fixer fix test.php
      - php-cs-fixer fix test.php
    fixture: '{}'
    if: '>=3.91'
  - php-cs-fixer fix test.php
  - cat test.php | grep "\$this->foo('Hello World!');"
